CREATE OR REPLACE ROLE SALES_USER;

GRANT ROLE SALES_USER TO ROLE SYSADMIN;

GRANT USAGE ON DATABASE SNOWFLAKE_POC TO SALES_USER;

USE ROLE SALES_USER;

SHOW TABLES;

GRANT USAGE ON SCHEMA SNOWFLAKE_POC.PUBLIC TO ROLE SALES_USER;

SHOW TABLES;

GRANT SELECT ON ALL TABLES IN SCHEMA SNOWFLAKE_POC.PUBLIC TO ROLE SALES_USER;

GRANT SELECT ON FUTURE TABLES IN SCHEMA SNOWFLAKE_POC.PUBLIC TO ROLE SALES_USER;

GRANT USAGE, OPERATE ON WAREHOUSE COMPUTE_WH TO ROLE SALES_USER;

USE ROLE ACCOUNTADMIN;

CREATE OR REPLACE MASKING POLICY PHONE AS (VAL VARCHAR) RETURNS VARCHAR ->
CASE
    WHEN CURRENT_ROLE() IN ('SALES_USER') THEN '******'
    ELSE VAL
END;

ALTER TABLE IF EXISTS CUSTOMER MODIFY COLUMN C_PHONE
SET MASKING POLICY PHONE;

SELECT * FROM CUSTOMER LIMIT 10;

USE WAREHOUSE COMPUTE_WH;

USE WAREHOUSE COMPUTE_WH;
USE ROLE SALES_USER;
